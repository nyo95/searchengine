generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ProjectStatus {
  PLANNING
  ONGOING
  DONE
}

model Brand {
  id                String   @id @default(cuid())
  name              String
  salesContactName  String
  salesContactPhone String
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  products Product[]
}

model Category {
  id        String   @id @default(cuid())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  subcategories Subcategory[]
}

model Subcategory {
  id                        String   @id @default(cuid())
  name                      String
  prefix                    String
  categoryId                String?
  defaultAttributesTemplate Json?
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt

  category Category? @relation(fields: [categoryId], references: [id])
  products Product[]

  @@unique([prefix, categoryId])
}

model Product {
  id             String   @id @default(cuid())
  name           String
  skuOrType      String
  brandId        String
  subcategoryId  String
  attributesData Json?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  brand         Brand                 @relation(fields: [brandId], references: [id])
  subcategory   Subcategory           @relation(fields: [subcategoryId], references: [id])
  scheduleItems ProjectScheduleItem[]
}

model Project {
  id         String        @id @default(cuid())
  name       String
  clientName String?
  status     ProjectStatus @default(PLANNING)
  budget     Decimal?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt

  scheduleItems ProjectScheduleItem[]
}

model ProjectScheduleItem {
  id        String   @id @default(cuid())
  projectId String
  productId String
  code      String
  quantity  Float?
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  project Project @relation(fields: [projectId], references: [id])
  product Product @relation(fields: [productId], references: [id])

  @@unique([projectId, code])
}
